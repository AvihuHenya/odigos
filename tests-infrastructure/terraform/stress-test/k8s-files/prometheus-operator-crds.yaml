# Prometheus Operator CRDs and dependencies
# This file should be applied before the prometheus-agent.yaml

---
# CustomResourceDefinition for PrometheusAgent
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: prometheusagents.monitoring.coreos.com
spec:
  group: monitoring.coreos.com
  names:
    kind: PrometheusAgent
    listKind: PrometheusAgentList
    plural: prometheusagents
    singular: prometheusagent
  scope: Namespaced
  versions:
    - name: v1alpha1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                serviceAccountName:
                  type: string
                serviceMonitorSelector:
                  type: object
                podMonitorSelector:
                  type: object
                serviceMonitorNamespaceSelector:
                  type: object
                podMonitorNamespaceSelector:
                  type: object
                probeSelector:
                  type: object
                externalLabels:
                  type: object
                scrapeInterval:
                  type: string
                retention:
                  type: string
                logLevel:
                  type: string
                remoteWrite:
                  type: array
                  items:
                    type: object
                resources:
                  type: object
                securityContext:
                  type: object
                storage:
                  type: object
      additionalPrinterColumns:
        - name: Version
          type: string
          jsonPath: .metadata.labels.operator\.prometheus\.io/version
        - name: Desired
          type: integer
          jsonPath: .spec.replicas
        - name: Ready
          type: integer
          jsonPath: .status.readyReplicas
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
      subresources:
        scale:
          specReplicasPath: .spec.replicas
          statusReplicasPath: .status.replicas
          labelSelectorPath: .status.labelSelector

---
# CustomResourceDefinition for ServiceMonitor
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: servicemonitors.monitoring.coreos.com
spec:
  group: monitoring.coreos.com
  names:
    kind: ServiceMonitor
    listKind: ServiceMonitorList
    plural: servicemonitors
    singular: servicemonitor
  scope: Namespaced
  versions:
    - name: v1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                selector:
                  type: object
                namespaceSelector:
                  type: object
                endpoints:
                  type: array
                  items:
                    type: object

---
# CustomResourceDefinition for PodMonitor
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: podmonitors.monitoring.coreos.com
spec:
  group: monitoring.coreos.com
  names:
    kind: PodMonitor
    listKind: PodMonitorList
    plural: podmonitors
    singular: podmonitor
  scope: Namespaced
  versions:
    - name: v1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                selector:
                  type: object
                namespaceSelector:
                  type: object
                podMetricsEndpoints:
                  type: array
                  items:
                    type: object

---
# CustomResourceDefinition for PrometheusRule
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: prometheusrules.monitoring.coreos.com
spec:
  group: monitoring.coreos.com
  names:
    kind: PrometheusRule
    listKind: PrometheusRuleList
    plural: prometheusrules
    singular: prometheusrule
  scope: Namespaced
  versions:
    - name: v1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                groups:
                  type: array
                  items:
                    type: object

---
# CustomResourceDefinition for Probe
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: probes.monitoring.coreos.com
spec:
  group: monitoring.coreos.com
  names:
    kind: Probe
    listKind: ProbeList
    plural: probes
    singular: probe
  scope: Namespaced
  versions:
    - name: v1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                targets:
                  type: array
                  items:
                    type: object
